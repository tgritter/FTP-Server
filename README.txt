I think we were able to get everything, expect for blocking in passive mode

There's also some compiler warnings, but it does seem to compile and run


